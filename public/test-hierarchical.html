<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‡Ø±Ù…ÙŠ - Haraj Clone</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
            font-size: 28px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            color: #444;
            font-weight: 600;
            font-size: 14px;
        }
        select, input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: white;
        }
        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        select:disabled, input:disabled {
            background: #f5f5f5;
            cursor: not-allowed;
            color: #999;
        }
        .results {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        .results h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }
        .result-item {
            padding: 10px;
            background: white;
            margin-bottom: 10px;
            border-radius: 5px;
            border-right: 4px solid #667eea;
        }
        .result-item strong {
            color: #667eea;
        }
        .loading {
            text-align: center;
            color: #667eea;
            font-size: 14px;
            margin-top: 10px;
        }
        .error {
            color: #e74c3c;
            font-size: 14px;
            margin-top: 5px;
        }
        .success-badge {
            display: inline-block;
            background: #2ecc71;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸª Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‡Ø±Ù…ÙŠ - Haraj Clone</h1>
        <p class="subtitle">Ø§Ù„ØªØ¯ÙÙ‚: Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© â†’ Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ© â†’ Ø§Ù„Ù…Ù†Ø·Ù‚Ø© â†’ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© â†’ Ø§Ù„Ù…Ø§Ø±Ú©Ø© â†’ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ â†’ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø®ØµØ§Ø¦Øµ</p>

        <div class="form-group">
            <label for="parent-category">
                <span class="success-badge">1</span>
                Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Parent Category)
            </label>
            <select id="parent-category">
                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© --</option>
            </select>
        </div>

        <div class="form-group">
            <label for="subcategory">
                <span class="success-badge">2</span>
                Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ© (Subcategory)
            </label>
            <select id="subcategory" disabled>
                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ© --</option>
            </select>
        </div>

        <div class="form-group">
            <label for="region">
                <span class="success-badge">3</span>
                Ø§Ù„Ù…Ù†Ø·Ù‚Ø© (Region)
            </label>
            <select id="region" disabled>
                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø© --</option>
            </select>
        </div>

        <div class="form-group">
            <label for="city">
                <span class="success-badge">4</span>
                Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© (City)
            </label>
            <select id="city" disabled>
                <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© --</option>
            </select>
        </div>

        <div id="attributes-container"></div>

        <div class="results" id="results" style="display: none;">
            <h3>ğŸ“‹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©:</h3>
            <div id="results-content"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://127.0.0.1:8000/api/v1';

        // Load parent categories
        async function loadParentCategories() {
            try {
                const response = await fetch(`${API_BASE}/categories`);
                const data = await response.json();
                const select = document.getElementById('parent-category');
                
                data.data.data
                    .filter(cat => !cat.parent_id)
                    .forEach(category => {
                        const option = document.createElement('option');
                        option.value = category.id;
                        option.textContent = category.name;
                        select.appendChild(option);
                    });
            } catch (error) {
                console.error('Error loading parent categories:', error);
            }
        }

        // Load subcategories
        async function loadSubcategories(parentId) {
            try {
                const response = await fetch(`${API_BASE}/categories/${parentId}/children`);
                const data = await response.json();
                const select = document.getElementById('subcategory');
                
                select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ© --</option>';
                
                data.data.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = category.name;
                    select.appendChild(option);
                });
                
                select.disabled = false;
            } catch (error) {
                console.error('Error loading subcategories:', error);
            }
        }

        // Load regions
        async function loadRegions() {
            try {
                const response = await fetch(`${API_BASE}/locations/regions`);
                const data = await response.json();
                const select = document.getElementById('region');
                
                select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø© --</option>';
                
                data.data.forEach(region => {
                    const option = document.createElement('option');
                    option.value = region.id;
                    option.textContent = region.name;
                    select.appendChild(option);
                });
                
                select.disabled = false;
            } catch (error) {
                console.error('Error loading regions:', error);
            }
        }

        // Load cities
        async function loadCities(regionId) {
            try {
                const response = await fetch(`${API_BASE}/locations/regions/${regionId}/cities`);
                const data = await response.json();
                const select = document.getElementById('city');
                
                select.innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© --</option>';
                
                data.data.forEach(city => {
                    const option = document.createElement('option');
                    option.value = city.id;
                    option.textContent = city.name;
                    select.appendChild(option);
                });
                
                select.disabled = false;
            } catch (error) {
                console.error('Error loading cities:', error);
            }
        }

        // Load attributes
        async function loadAttributes(categoryId) {
            try {
                const response = await fetch(`${API_BASE}/categories/attributes?category_id=${categoryId}`);
                const data = await response.json();
                const container = document.getElementById('attributes-container');
                
                container.innerHTML = '';
                
                const attributes = data.data.data.filter(attr => !attr.parent_id);
                
                for (let i = 0; i < attributes.length; i++) {
                    const attr = attributes[i];
                    const formGroup = document.createElement('div');
                    formGroup.className = 'form-group';
                    
                    const label = document.createElement('label');
                    label.innerHTML = `<span class="success-badge">${5 + i}</span> ${attr.name}`;
                    
                    if (attr.type === 'select') {
                        const select = document.createElement('select');
                        select.id = `attr-${attr.id}`;
                        select.dataset.attributeId = attr.id;
                        
                        const defaultOption = document.createElement('option');
                        defaultOption.value = '';
                        defaultOption.textContent = `-- Ø§Ø®ØªØ± ${attr.name} --`;
                        select.appendChild(defaultOption);
                        
                        attr.options.forEach(option => {
                            const opt = document.createElement('option');
                            opt.value = option.id;
                            opt.textContent = option.value;
                            select.appendChild(opt);
                        });
                        
                        select.addEventListener('change', async (e) => {
                            const optionId = e.target.value;
                            const attributeId = e.target.dataset.attributeId;
                            
                            if (optionId) {
                                await loadChildAttributes(attributeId, optionId);
                            }
                            
                            updateResults();
                        });
                        
                        formGroup.appendChild(label);
                        formGroup.appendChild(select);
                    } else if (attr.type === 'number') {
                        const input = document.createElement('input');
                        input.type = 'number';
                        input.id = `attr-${attr.id}`;
                        input.placeholder = `Ø£Ø¯Ø®Ù„ ${attr.name}`;
                        
                        input.addEventListener('input', updateResults);
                        
                        formGroup.appendChild(label);
                        formGroup.appendChild(input);
                    }
                    
                    container.appendChild(formGroup);
                }
            } catch (error) {
                console.error('Error loading attributes:', error);
            }
        }

        // Load child attributes
        async function loadChildAttributes(parentId, optionId) {
            try {
                const response = await fetch(`${API_BASE}/categories/attributes/${parentId}/children?option_id=${optionId}`);
                const data = await response.json();
                
                // Remove existing child attributes
                const existingChild = document.querySelector(`[data-parent-attribute="${parentId}"]`);
                if (existingChild) {
                    existingChild.remove();
                }
                
                if (data.data.data && data.data.data.length > 0) {
                    const childAttr = data.data.data[0];
                    
                    const formGroup = document.createElement('div');
                    formGroup.className = 'form-group';
                    formGroup.dataset.parentAttribute = parentId;
                    
                    const label = document.createElement('label');
                    label.innerHTML = `<span class="success-badge">â†³</span> ${childAttr.name} (ØªØ§Ø¨Ø¹ Ù„Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚)`;
                    
                    const select = document.createElement('select');
                    select.id = `child-attr-${childAttr.id}`;
                    
                    const defaultOption = document.createElement('option');
                    defaultOption.value = '';
                    defaultOption.textContent = `-- Ø§Ø®ØªØ± ${childAttr.name} --`;
                    select.appendChild(defaultOption);
                    
                    childAttr.options.forEach(option => {
                        const opt = document.createElement('option');
                        opt.value = option.id;
                        opt.textContent = option.value;
                        select.appendChild(opt);
                    });
                    
                    select.addEventListener('change', updateResults);
                    
                    formGroup.appendChild(label);
                    formGroup.appendChild(select);
                    
                    // Insert after parent attribute
                    const parentSelect = document.querySelector(`#attr-${parentId}`);
                    if (parentSelect) {
                        parentSelect.closest('.form-group').after(formGroup);
                    }
                }
            } catch (error) {
                console.error('Error loading child attributes:', error);
            }
        }

        // Update results
        function updateResults() {
            const resultsDiv = document.getElementById('results');
            const resultsContent = document.getElementById('results-content');
            
            const parentCategory = document.getElementById('parent-category');
            const subcategory = document.getElementById('subcategory');
            const region = document.getElementById('region');
            const city = document.getElementById('city');
            
            let html = '';
            
            if (parentCategory.value) {
                html += `<div class="result-item"><strong>Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:</strong> ${parentCategory.options[parentCategory.selectedIndex].text}</div>`;
            }
            if (subcategory.value) {
                html += `<div class="result-item"><strong>Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ©:</strong> ${subcategory.options[subcategory.selectedIndex].text}</div>`;
            }
            if (region.value) {
                html += `<div class="result-item"><strong>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:</strong> ${region.options[region.selectedIndex].text}</div>`;
            }
            if (city.value) {
                html += `<div class="result-item"><strong>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</strong> ${city.options[city.selectedIndex].text}</div>`;
            }
            
            // Get all attribute selects and inputs
            const attributeInputs = document.querySelectorAll('[id^="attr-"], [id^="child-attr-"]');
            attributeInputs.forEach(input => {
                if (input.value) {
                    const label = input.previousElementSibling || input.closest('.form-group').querySelector('label');
                    const labelText = label.textContent.replace(/^\d+\s*/, '').replace(/â†³\s*/, '').replace(/\(.*\)/, '').trim();
                    
                    if (input.tagName === 'SELECT') {
                        html += `<div class="result-item"><strong>${labelText}:</strong> ${input.options[input.selectedIndex].text}</div>`;
                    } else {
                        html += `<div class="result-item"><strong>${labelText}:</strong> ${input.value}</div>`;
                    }
                }
            });
            
            if (html) {
                resultsContent.innerHTML = html;
                resultsDiv.style.display = 'block';
            } else {
                resultsDiv.style.display = 'none';
            }
        }

        // Event listeners
        document.getElementById('parent-category').addEventListener('change', async (e) => {
            const parentId = e.target.value;
            
            if (parentId) {
                await loadSubcategories(parentId);
                await loadRegions();
            } else {
                document.getElementById('subcategory').disabled = true;
                document.getElementById('subcategory').innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ© --</option>';
            }
            
            // Reset dependent fields
            document.getElementById('region').disabled = true;
            document.getElementById('city').disabled = true;
            document.getElementById('attributes-container').innerHTML = '';
            
            updateResults();
        });

        document.getElementById('subcategory').addEventListener('change', async (e) => {
            const categoryId = e.target.value;
            
            if (categoryId) {
                await loadAttributes(categoryId);
            } else {
                document.getElementById('attributes-container').innerHTML = '';
            }
            
            updateResults();
        });

        document.getElementById('region').addEventListener('change', async (e) => {
            const regionId = e.target.value;
            
            if (regionId) {
                await loadCities(regionId);
            } else {
                document.getElementById('city').disabled = true;
                document.getElementById('city').innerHTML = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© --</option>';
            }
            
            updateResults();
        });

        document.getElementById('city').addEventListener('change', updateResults);

        // Initialize
        loadParentCategories();
    </script>
</body>
</html>